name: Auto Close PR on Conflict
 
on:
  pull_request:
    types: [opened, synchronize]
 
jobs:
  check-conflict:
    runs-on: ubuntu-latest
    steps:
    - name: Check for merge conflicts
      uses: actions/github-script@v7
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        script: |
          const pr = await github.rest.pulls.get({
            owner: context.repo.owner,
            repo: context.repo.repo,
            pull_number: context.payload.pull_request.number
          });
 
          if (pr.data.mergeable === false) {
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: pr.data.number,
              body: "❌ This PR has merge conflicts and will be closed automatically."
            });
 
            await github.rest.pulls.update({
              owner: context.repo.owner,
              repo: context.repo.repo,
              pull_number: pr.data.number,
              state: "closed"
            });
          } else {
            console.log("✅ No conflict, PR is mergeable.");
          }
 
